<!DOCTYPE html>
<html>
  <head>
    <title>ActivityPub</title>
    <meta charset="utf-8">
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common"
            async class="remove"></script>
    <script class="remove">
      var respecConfig = {
          specStatus: "ED",
          publishDate: "2017-03-05",
          previousPublishDate: "2016-11-17",
          previousMaturity: "WD",
          license: "w3c-software-doc",
          shortName:  "activitypub",
          wg: "Social Web Working Group",
          wgURI: "https://www.w3.org/Social/WG",
          wgPublicList: "public-socialweb",
          wgPatentURI: "https://www.w3.org/2004/01/pp-impl/72531/status",
          edDraftURI: "https://w3c.github.io/activitypub/",
          testSuiteURI: "https://activitypub.rocks/test",
          implementationReportURI: "https://activitypub.rocks/implementation-report",
          otherLinks: [
              {
                  "key": "Repository",
                  "data": [
                      {
                          "value": "Git repository",
                          "href": "https://github.com/w3c/activitypub",
                      },
                      {
                          "value": "Issues",
                          "href": "https://github.com/w3c/activitypub/issues",
                      },
                      {
                          "value": "Commits",
                          "href": "https://github.com/w3c/activitypub/commits/gh-pages",
                      }
                  ]
              }
          ],
          editors: [
                {
                    name:       "Christopher Allan Webber",
                    url:        "http://dustycloud.org/",
                    mailto:     "cwebber@dustycloud.org",
                    w3cid:      "57007"
                },
                {
                    name:       "Jessica Tallon",
                    url:        "http://theperplexingpariah.co.uk",
                    mailto:     "tsyesika@tsyesika.se",
                    w3cid:      "72695"
                },
          ],
          authors: [
              {
                  name:       "Owen Shepherd",
                  url:        "https://owenshepherd.net/",
                  mailto:     "owen.shepherd@e43.eu"
              },
          ],
          localBiblio:  {
            "ActivityStreams": {
              title:    "Activity Streams 2.0",
              href:     "https://www.w3.org/TR/activitystreams-core/",
              authors:  [
                "J. Snell",
              ],
              status:   "Editors Draft",
              publisher:  "ActivityStreams Working Group",
            },
            "Activity-Vocabulary": {
              title:    "Activity Vocabulary",
              href:     "https://www.w3.org/TR/activitystreams-vocabulary/",
              authors:  [
                "J. Snell",
              ],
              status:   "Editors Draft",
              publisher:  "ActivityStreams Working Group",
            },
            "OAuth-Server-Metadata": {
              title:    "OAuth 2.0 Authorization Server Metadata",
              href:     "https://tools.ietf.org/id/draft-ietf-oauth-discovery-06.html",
              authors:  [
                "M. Jones",
                "N. Sakimura",
                "J. Bradley"
              ],
              status:   "Internet-Draft",
              publisher:  "OAuth Working Group",
            },
        },
      };
    </script>
  </head>
  <!-- STYLISTIC NOTE: This document wraps on column 79 and at the end of every
       sentence. -->
  <body>
    <section id="abstract">
      <p>
        The ActivityPub protocol is a decentralized social networking protocol
        based upon the [[!ActivityStreams]] 2.0 data format.
        It provides a client to server API for creating, updating and deleting
        content, as well as a federated server to server API for delivering
        notifications and content.
      </p>
    </section>

    <section id="sotd">
      <p>
        This document is a proposed submission to the W3C Social working group.
      </p>
    </section>

    <section id="Overview">
      <h2>Overview</h2>
      <p>
        The ActivityPub protocol is broadly based on the distribution of
        <i>activities</i>, described using [[!ActivityStreams]]; these
        activities are produced in response to a user performing delivery of an
        activity.
        Most activities are purely responsive in nature - they are produced as
        a response to a user having <em>done</em> something.
        In addition, certain activities posted by a user to their
        <a href="#outbox">outbox</a> may trigger certain side effects on the
        user's behalf.
        Finally, activities may have side effects as they propagate throughout
        the social graph by being posted to the <a href="#inbox">inboxes</a>
        of other actors on the network.
        As an example of this:
      </p>
      <ol>
        <li>
          A user posts the <code>Like</code> activity to their outbox.
          This activity causes the user's server to perform delivery of an
          activity on behalf of the user, adding the specified object to the
          collection of objects the user has liked.
        </li>
        <li>
          A consequence of the above activity (per
          <a href="#delivery"></a>) is that the server hosting the liked
          object will be notified of the operation, and will normally add the
          activity to the list of "likes" the object has received.
          (ActivityPub makes use of
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#audienceTargeting">
            ActivityStreams' audience targeting facilities</a>.)
        </li>
        <li>
          Finally, the server receiving the like will distribute this activity
          to everyone it distributed the original object to.
        </li>
      </ol>

      <section id="social-web-working-group" inlist="" rel="schema:hasPart"
               resource="#social-web-working-group">
        <h3 property="schema:name">Social Web Working Group</h3>
        <div datatype="rdf:HTML" property="schema:description">
          <p>
            <a href="#Overview">ActivityPub</a> is one of several related
            specifications being produced by the Social Web Working Group.
            Implementers interested in alternative approaches and complementary
            protocols should review [[Micropub]] and the overview document
            [[Social-Web-Protocols]].
          </p>
        </div>
      </section>
    </section>

    <section id="conformance">
      <section id="specification-profiles">
        <h2>Specification Profiles</h2>
        <p>
          This specification defines two closely related and interacting
          protocols:
        </p>
        <dl>
          <dt>A client to server protocol, or "Social API"</dt>
          <dd>
            This protocol permits a client to act <i>on behalf</i> of a user.
            For example, this protocol is used by a mobile phone application to
            interact with the user's social stream.
          </dd>
          <dt>A server to server protocol, or "Federation Protocol"</dt>
          <dd>
            This protocol is used to distribute activities between users on
            different servers, tying them into the same social graph.
          </dd>
        </dl>
        <p>
          The ActivityPub specification is designed so that once either of
          these protocols are implemented, supporting the other is of very
          little additional effort.
          However, servers may still implement one without the other.
          This gives three conformance classes:
        </p>
        <dl>
          <dt>ActivityPub conformant Client</dt>
          <dd>
            This designation applies to any implementation of the entirety of the
            client portion of the client to server protocol.
          </dd>
          <dt>ActivityPub conformant Server</dt>
          <dd>
            This designation applies to any implementation of the entirety of the
            server portion of the client to server protocol.
          </dd>
          <dt>ActivityPub conformant Federated Server</dt>
          <dd>
            This designation applies to any implementation of the entirety of
            the federation protocols.
          </dd>
        </dl>
        <p>
          It is called out whenever a portion of the specification only applies
          to implementation of the federation protocol.
          In addition, whenever requirements are specified, it is called out
          whether they apply to the client or server (for the client-to-server
          protocol) or whether referring to a sending or receiving server in
          the server-to-server protocol.
        </p>
      </section>
      <section id="cr-exit-criteria">
        <h2>Candidate Recommendation Exit Criteria</h2>
        <p>
          For this specification to advance to Proposed Recommendation, there
          must be at least two independent, interoperable implementations of
          each feature. Each feature may be implemented by a different set of
          products. There is no requirement that all features be implemented by
          a single product.
        </p>
        <ul>
          <li>
            <strong>Independent</strong>
            implementations are developed by different parties and cannot
            share, reuse or derive from another qualifying implementation code
            which is directly pertinent to the implementation of this
            specification.
          </li>
          <li>
            <strong>Interoperability</strong>
            occurs between clients and servers, or between servers and other
            servers, when the client/server makes a request to the targeted
            server, and the targeted server sends the expected response, as
            defined by this specification.
          </li>
          <li>
            An <strong>implementation</strong> is an ActivityPub client,
            server or federated server which implements the corresponding
            conformance class of the specification.
          </li>
        </ul>
        <p>
          For the purposes of evaluating exit criteria, each of the following
          is considered a feature:
        </p>
        <ul>
          <li>
            Discovering an actor's profile based on their URI (either the
            representation of the actor itself, which is probably an
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#actor-types">Actor Type</a>,
            or a
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-profile">Profile</a>
            object describing the actor).
            See the <a href="#actors">Actors</a> section of this document for
            more information on what information is expected.
          </li>
          <li>
            A client receiving authorization and subsequently submitting an
            activity to the authenticated actor's outbox.
          </li>
          <li>
            A server handling an activity submitted by an authenticated actor
            to their outbox and handling client to server interaction
            side effects appropriately.
          </li>
          <li>
            A federated server delivering an activity posted by a local actor
            to the inbox endpoints of all recipients specified in the activity,
            including those on other remote federated servers.
          </li>
          <li>
            A federated server receiving an activity to its actor's inbox,
            validating that the activity and any nested objects were created by
            their respective actors, and handling server to server side effects
            appropriately.
          </li>
        </ul>
      </section>

      <section id="atrisk">
        <h2>At Risk features</h2>
        <p>
          The Working Group has marked the following features as At
          Risk and may seek to advance the specification with the
          removal of these features if insufficient implementation
          experience can be gathered.
        </p>
        <ul>
          <li>
            <a href="#uploading-media"></a> and
            its associated <a href="#uploadMedia"></a> endpoint.
          </li>
          <li>
            <a href="#source-property"></a>.
          </li>
          <li>
            The
            <a href="#preferredUsername"><code>preferredUsername</code></a>
            property.
          </li>
          <li>
            <a href="#public-inbox-delivery"></a> section
            and its associated
            <a href="#publicInbox"><code>publicInbox</code></a>
            endpoint.
          </li>
          <li>
            <a href="#object-without-create"></a>.
          </li>
          <li>
            <a href="#partial-updates"></a>.
            In absence of this section, updates for client to server
            result in an entire replacement of the object rather than
            modifying individual fields.
          </li>
        </ul>
      </section>
    </section>

    <section id="obj">
      <h2>Objects</h2>
      <p>
        Objects are the core concept around which both [[!ActivityStreams]] and
        ActivityPub are built.
        Objects are often wrapped in Activities and are contained in streams of
        Collections, which are themselves subclasses of Objects.
        See the [[!Activity-Vocabulary]] document, particularly the
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#types">Core Classes</a>;
        ActivityPub follows the mapping of this vocabulary very closely.
      </p>
      <p>
        ActivityPub defines some terms in addition to those provided by
        ActivityStreams.
        These terms are provided in the ActivityPub
        <a href="http://www.w3.org/TR/json-ld/#the-context">JSON-LD context</a>
        at
        <code>https://www.w3.org/ns/activitystreams</code>.
        Implementers SHOULD include the ActivityPub context in their
        object definitions.
        Implementers MAY include additional context as appropriate.
      </p>
      <p>
        ActivityPub shares the same
        <a href="https://www.w3.org/TR/activitystreams-core/#urls">
          URI / IRI conventions as in ActivityStreams</a>.
      </p>
      <p>
        Servers SHOULD validate the content they receive to avoid content
        spoofing attacks.
        In particular, servers SHOULD NOT trust client submitted content, and
        federated servers also SHOULD NOT trust content received from a server
        other than the content's origin without some form of verification.
        No particular mechanism for verification is authoritively specified by
        this document, though some possible directions are discussed in
        <a href="#authorization"></a>.
        (A server should do something at least as robust as checking that
        the object appears as received at its origin, but better mechanisms
        such as checking signatures would be better if available.)
      </p>
      <div class="informative">
        As an example, if example.com receives the activity
        <pre class="example">
         {
           "@context": "https://www.w3.org/ns/activitystreams",
           "type": "Like",
           "actor": "https://example.net/~mallory",
           "to": ["https://hatchat.example/sarah/",
                  "https://example.com/peeps/john/"],
           "object": {
             "@context": {"@language": "en"},
             "id": "https://example.org/~alice/note/23",
             "type": "Note",
             "attributedTo": "https://example.org/~alice",
             "content": "I'm a goat"
           }
         }
        </pre>
        it should dereference the <code>id</code> both to ensure that it exists
        and is a valid object, and that it is not misrepresenting the object.
        (In this example, Mallory could be spoofing an object allegedly posted
        by Alice.)
      </div>
      <section id="obj-id">
        <h2>Object Identifiers</h2>
        <p>
          All Objects in [[!ActivityStreams]] should have unique global
          identifiers.
          ActivityPub extends this requirement; all objects distributed by the
          ActivityPub protocol MUST have unique global identifiers, unless they
          are intentionally transient (short lived activities that are not
          intended to be able to be looked up, such as some kinds of chat
          messages or game notifications).
          These identifiers must fall into one of the following groups:
        </p>
        <ol>
          <li>
            Publicly dereferencable URIs, such as HTTPS URIs, with their
            authority belonging to that of their originating server.
            (Publicly facing content SHOULD use HTTPS URIs.)
          </li>
          <li>
            An ID explicitly specified as the JSON <code>null</code> object,
            which implies an anonymous object (a part of its parent context)
          </li>
        </ol>
        <p>
          Identifiers MUST be provided for activities posted in server to
          server communication, unless the activity is intentionally transient.
          However, for client to server communication, a server receiving an
          object posted to the outbox with no specified <code>id</code> SHOULD
          allocate an object ID in the user's namespace and attach it to the
          posted object.
        </p>
        <p>All objects have the following properties:</p>
        <dl>
          <dt>id</dt>
          <dd>
            The object's unique global identifier (unless the object is transient,
            in which case the <code>id</code> MAY be omitted).
          </dd>
          <dt>type</dt>
          <dd>
            The type of the object.
          </dd>
        </dl>
      </section>

      <section id="retrieving-objects">
        <h2>Retrieving objects</h2>
        <p>
          The HTTP GET method may be dereferenced against an object's
          <code>id</code> property to retrieve the activity.
          Servers MAY use HTTP content negotiation as defined in [[!RFC7231]] to
          select the type of data to return in response to a request,
          but MUST present the ActivityStreams object representation
          in response to
          <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>,
          and SHOULD also present the ActivityStreams representation in
          response to <code>application/activity+json</code> as well.
          The client MUST specify an <code>Accept</code> header with the
          <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>
          media type in order to retrieve the activity.
        </p>
        <p>
          Servers MAY implement other behavior for requests which do not comply
          with the above requirement.
          (For example, servers may implement additional legacy protocols, or
          may use the same URI for both HTML and ActivityStreams
          representations of a resource).
        </p>
        <p>
          Servers MAY require authorization as specified in
          <a href="#authorization"></a>, and may additionally implement their
          own authorization rules.
          Servers SHOULD fail requests which do not pass their authorization
          checks with the appropriate HTTP error code, or the 403 Forbidden
          error code where the existence of the object is considered private.
          An origin server which does not wish to disclose the existence of
          a private target MAY instead respond with a status code of
          404 Not Found.
        </p>
      </section>

      <section id="source-property">
        <h2>The source property</h2>
        <p>
          In addition to all the properties defined by the
	  [[!Activity-Vocabulary]], ActivityPub extends the <code>Object</code> by
	  supplying the <code>source</code> property.
          The <code>source</code> property is intended to convey some
          sort of source from which the <code>content</code> markup
          was derived, as a form of provenance, or to support future
          editing by clients.
          In general, clients do the conversion from <code>source</code>
          to <code>content</code>, not the other way around.
        </p>
        <p>
          The value of <code>source</code> is itself an object
          which uses its own <code>content</code> and <code>mediaType</code>
          fields to supply source information.
        </p>
        <pre class="example">
          {
            "@context": ["https://www.w3.org/ns/activitystreams",
                         {"@language": "en"}],
            "object": "Note",
            "id": "http://postparty.example/p/2415",
            "content": "&lt;p&gt;I &lt;em&gt;really&lt;/em&gt; like strawberries!&lt;/p&gt;",
            "source": {
              "content": "I *really* like strawberries!",
              "mediaType": "text/markdown"},
          }
        </pre>
        <div class="note"
             title="What to do when clients can't meaningfully handle a mediaType?">
          <p>
            In general, it's best to let a user edit their original post
            in the same source format they originally composed it in.
            But not all clients can reliably provide a nice interface for
            all source types, and since clients are expected to do the
            conversion from <code>source</code> to <code>content</code>,
            some clients may work with a media type that another client
            does not know how to work with.
            While a client could feasibly provide the <code>content</code>
            markup to be edited and ignore the source, this means that the
            user will lose the more desirable form of the original
            <code>source</code> in any future revisions.
            A client doing so should thus provide a minimally obtrusive warning
            cautioning that the original source format is not understood and is
            thus being ignored.
          </p>
          <p>
            For example, Alyssa P. Hacker likes to post to her ActivityPub
            powered blog via an Emacs client she has written, leveraging
            <a href="http://orgmode.org/">Org mode</a>.
            Later she switches to editing on her phone's client, which
            has no idea what <code>text/x-org</code> is or how to render
            it to HTML, so it provides a text box to edit the original
            <code>content</code> instead.
            A helpful warning displays above the edit area saying,
            "This was originally written in another markup language we don't
            know how to handle.  If you edit, you'll lose your original
            source!"
            Alyssa decides the small typo fix isn't worth losing her nice
            org-mode markup and decides to make the update when she gets
            home.
          </p>
        </div>
      </section>
    </section>

    <section id="actors">
      <h2>Actors</h2>
      <p>
        ActivityPub actors are generally one of the
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#actor-types">
          ActivityStreams Actor Types</a>,
        but they don't have to be. For example, a 
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-profile">
          Profile</a> object
        might be used as an actor, or a type from an ActivityStreams extension.
        Actors are <a href="#retrieving-objects">retrieved</a> like any other
        Object in ActivityPub.
        Like other ActivityStreams objects, actors have an <code>id</code>,
        which is a URI.
        When entered directly into a user interface (for example on a login
        form), it is desirable to support simplified naming.
        For this purpose, ID normalization SHOULD be performed as follows:
      </p>
      <ol>
        <li>
          If the entered ID is a valid URI, then it is to be used directly.
        </li>
        <li>
          If it appears that the user neglected to add a scheme for a URI that
          would otherwise be considered valid, such as
          <code>example.org/alice/</code>, clients MAY attempt to provide
          a default scheme, preferably <code>https</code>.
        </li>
        <li>
          Otherwise, the entered value should be considered invalid.
        </li>
      </ol>

      <p>
        Once the actor's URI has been identified, it should be dereferenced.
      </p>

      <section id="actor-objects">
        <h2><i>Actor</i> objects</h2>
        <p>
          Actor objects MUST have, in addition to the properties mandated by
          <a href="#obj-id"></a>, the following properties:
        </p>
        <dl>
          <dt id="inbox-property">inbox</dt>
          <dd>
            A reference to an [[!ActivityStreams]]
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
              <code>OrderedCollection</code></a>
            comprised of all the messages received by the actor; see
            <a href="#inbox"></a>.
          </dd>
          <dt id="outbox-property">outbox</dt>
          <dd>
            An [[!ActivityStreams]]
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
              <code>OrderedCollection</code></a>
            comprised of all the messages produced by the actor; see
            <a href="#outbox"></a>.
          </dd>
        </dl>
        <p>
          Implementations SHOULD, in addition, provide the following
          properties:
        </p>
        <dl>
          <dt id="following-property">following</dt>
          <dd>
            A link to an [[!ActivityStreams]] collection of the actors that
            this actor is following; see <a href="#following"></a>
          </dd>
          <dt id="followers-property">followers</dt>
          <dd>
            A link to an [[!ActivityStreams]] collection of the actors that
            follow this actor; see <a href="#followers"></a>.
          </dd>
          <dt id="liked-property">liked</dt>
          <dd>
            A link to an [[!ActivityStreams]] collection of objects this
            actor has liked; see <a href="#liked"></a>.
          </dd>
        </dl>
        <pre class="example">
{
  "@context": ["https://www.w3.org/ns/activitystreams",
               {"@language": "ja"}],
  "type": "Person",
  "id": "https://kenzoishii.example.com/",
  "following": "https://kenzoishii.example.com/following.json",
  "followers": "https://kenzoishii.example.com/followers.json",
  "liked": "https://kenzoishii.example.com/liked.json",
  "inbox": "https://kenzoishii.example.com/inbox.json",
  "outbox": "https://kenzoishii.example.com/feed.json",
  "preferredUsername": "kenzoishii",
  "name": "石井健蔵",
  "summary": "この方はただの例です",
  "icon": [
    "https://kenzoishii.example.com/image/165987aklre4"
  ]
}
        </pre>
        <p>Implementations MAY, in addition, provide the following properties:</p>
        <dl>
          <dt id="streams-property">streams</dt>
          <dd>
            A list of supplementary Collections which may be of interest.
          </dd>
          <dt id="preferredUsername">preferredUsername</dt>
          <dd>
            A short username which may be used to refer to the actor, with no
            uniqueness guarantees.
          </dd>
          <dt id="endpoints">endpoints</dt>
          <dd>
            A json object which maps additional endpoints which may be useful
            either for this actor or someone referencing this actor.
            This mapping may be nested inside the actor document as the value
            or may be a link to a JSON-LD document with these properties.
          </dd>
        </dl>

        <p>
          The <code>endpoints</code> mapping MAY include the following
          properties:
        </p>
        <dl>
          <dt id="uploadMedia">uploadMedia</dt>
          <dd>
            <a href="#uploading-media">Upload endpoint URI</a>
            for this user for binary data.
          </dd>
          <dt id="proxyUrl">proxyUrl</dt>
          <dd>
            Endpoint URI so this actor's clients may access remote
            ActivityStreams objects which require authentication to access.
            To use this endpoint, the client posts an
            <code>x-www-form-urlencoded</code> <code>id</code> parameter
            with the value being the <code>id</code> of the requested
            ActivityStreams object.
          </dd>
          <dt id="oauthAuthorizationEndpoint">oauthAuthorizationEndpoint</dt>
          <dd>
            If OAuth 2.0 bearer tokens [[RFC6749]] [[RFC6750]] are being used
            for authenticating
            <a href="#client-to-server-interactions">client to server
              interactions</a>,
            this endpoint specifies a URI at which a browser-authenticated user
            may obtain a new authorization grant.
          </dd>
          <dt id="oauthTokenEndpoint">oauthTokenEndpoint</dt>
          <dd>
            If OAuth 2.0 bearer tokens [[RFC6749]] [[RFC6750]] are being used
            for authenticating
            <a href="#client-to-server-interactions">client to server
              interactions</a>,
            this endpoint specifies a URI at which a client may acquire an
	    access token.
          </dd>
          <dt id="provideClientKey">provideClientKey</dt>
          <dd>
            If Linked Data Signatures and HTTP Signatures are being used for
            authentication and authorization, this endpoint specifies a URI at
            which browser-authenticated users may authorize a client's public
            key for
            <a href="#client-to-server-interactions">client to server
              interactions</a>.
          </dd>
          <dt id="signClientKey">signClientKey</dt>
          <dd>
            If Linked Data Signatures and HTTP Signatures are being used for
            authentication and authorization, this endpoint specifies a URI at
            which a client key may be signed by the actor's key for a time
            window to act on behalf of the actor in interacting with foreign
            servers.
          </dd>
          <dt id="publicInbox">publicInbox</dt>
          <dd>
            An optional endpoint
            <a href="#public-inbox-delivery">
              used for wide delivery of publicly addressed activities</a>.
            <code>publicInbox</code> endpoints SHOULD also be publicly
            readable <code>OrderedCollection</code> objects.
          </dd>
        </dl>

        <div class="note" id="as2-actor-properties">
          <p>
            As the upstream vocabulary for ActivityPub, any applicable
            [[!ActivityStreams]] property may be used on ActivityPub Actors.
            Some ActivityStreams properties are particularly worth highlighting
            to demonstrate how they are used in ActivityPub implementations.
          </p>

          <dl>
            <dt id="url-property">url</dt>
            <dd>
              A link to the actor's "profile web page", if not equal to the
              value of <code>id</code>.
            </dd>
            <dt id="name-property">name</dt>
            <dd>
              The preferred "nickname" or "display name" of the actor.
            </dd>
            <dt id="summary-property">summary</dt>
            <dd>A quick summary or bio by the user about themselves.</dd>
            <dt id="icon-property">icon</dt>
            <dd>
              A link to an image or an Image object which represents the user's
              profile picture (this may be a thumbnail).
            </dd>
          </dl>
        </div>
        <p class="note" id="actor-text-direction">
          Properties containing natural language values,
          such as <code>name</code>, <code>preferredUsername</code>, or
          <code>summary</code>, make use of
          <a href="https://www.w3.org/TR/activitystreams-core/#naturalLanguageValues">
            natural language support defined in ActivityStreams</a>.
        </p>
      </section>

    </section>

    <section id="collections">
      <h2>Collections</h2>
      <p>
        [[!ActivityStreams]] defines the collection concept; ActivityPub
        defines several collections with special behavior.
        Note that ActivityPub makes use of
        <a href="https://www.w3.org/TR/activitystreams-core/#paging">
          ActivityStreams paging</a>
        to traverse large sets of objects.
      </p>

      <p>
        Note that some of these collections are specified to be of type
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
          <code>OrderedCollection</code></a>
        specifically, while others are permitted to be either a
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
          <code>Collection</code></a>
        or an
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
          <code>OrderedCollection</code></a>.
        An
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
          <code>OrderedCollection</code></a>
        MUST be presented consistently in reverse chronological order.
      </p>

      <p class="note">
        What property is used to determine the reverse chronological order
        is intentionally left as an implementation detail.
        For example, many SQL-style databases use an incrementing integer
        as an identifier, which can be reasonably used for handling
        insertion order in most cases.
        In other databases, an insertion time timestamp may be preferred.
        What is used isn't important, but the ordering of elements must
        remain intact, with newer items first.
        A property which changes regularly, such a "last updated" timestamp,
        should not be used.
      </p>

      <section id="outbox">
        <h2>Outbox</h2>
        <p>
          The outbox is discovered through the <code>outbox</code>
          property of an <a href="#actors">actor's</a> profile.
          The <code>outbox</code> MUST be an
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>.
        </p>
        <p>
          The outbox stream contains objects the user has
          published, subject to the ability of the requestor to retrieve the
          object (that is, the contents of the outbox are filtered by the
          permissions of the person reading it).
          If a user submits a request without
          <a href="#authorization">Authorization</a> the server should
          respond with all of the <a href="#public-addressing">Public</a>
          posts.
          This could potentially be all relevant objects published by the
          user, though the number of available items is left to the
          discretion of those implementing and deploying the server.
        </p>
        <p>
          The outbox accepts HTTP POST requests, with behaviour described in
          <a href="#client-to-server-interactions">Client to Server
            Interactions</a>.
        </p>
      </section>

      <section id="inbox">
        <h2>Inbox</h2>

        <p>
          The inbox is discovered through the <code>inbox</code>
          property of an <a href="#actors">actor's</a> profile.
          The <code>inbox</code> MUST be an
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>.
        </p>

        <p>
          The inbox stream contains all objects received by the
          user.
          The server SHOULD filter content according to the requester's
          permission.
          In general, the owner of an inbox is likely to be able to access
          all of their inbox contents. Depending on access control, some
          other content may be public, whereas other content may require
          authentication for non-owner users, if they can access the inbox
          at all.
        </p>

        <p>
          The server MUST perform de-duplication of activities returned by
          the inbox. Duplication can occur if an activity is addressed both
          to a user's followers, and a specific
          user who also follows the recipient user, and the server has failed
          to de-duplicate the recipients list.
          Such deduplication MUST be performed by comparing the
          <code>id</code> of the activities and dropping any activities
          already seen.
        </p>

        <p>
          The inboxes of actors on federated servers accepts HTTP POST requests,
          with behaviour described in <a href="#delivery">Delivery</a>.
          Non-federated servers SHOULD return a 405 Method Not Allowed upon
          receipt of a POST request.
        </p>
      </section>

      <section id="followers">
        <h2>Followers Collection</h2>
        <p>
          Every <a href="#actors">actor</a> SHOULD have a <code>followers</code>
          collection.
          This is a list of everyone who has sent a
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-follow">Follow</a>
          activity for the user, added as a
          <a href="#follow-activity-outbox">side effect</a>.
          This is where one would find a list of all the users that are
          following the actor.
          The <code>followers</code> collection MUST be either an
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>
          or a
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
            <code>Collection</code></a>
          and MAY be filtered on privileges of an authenticated user
          or as appropriate when no authentication is given.
        </p>

        <p class="note" title="Default for notification targeting">
          The follow activity generally is a request to see the objects a user
          creates. This makes the Followers collection an appropriate default
          target for <a href="#delivery">delivery</a> of notifications.
        </p>
      </section>

      <section id="following">
        <h2>Following Collection</h2>
        <p>
          Every actor SHOULD have a <code>following</code> collection.
          This is a list of everybody that the actor has followed, added as a
          <a href="#follow-activity-outbox">side effect</a>.
          The <code>following</code> collection MUST be either an
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>
          or a
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
            <code>Collection</code></a>
          and MAY be filtered on privileges of an authenticated user
          or as appropriate when no authentication is given.
        </p>
      </section>

      <section id="liked">
        <h2>Liked Collection</h2>
        <p>
          Every actor MAY have a <code>liked</code> collection.
          This is a list of every object from all of the actor's <code>Like</code>
          activities, added as a <a href="#like-activity-outbox">side effect</a>.
          The <code>liked</code> collection MUST be either an
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>
          or a
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
            <code>Collection</code></a>
          and MAY be filtered on privileges of an authenticated user
          or as appropriate when no authentication is given.
        </p>
      </section>

      <section id="public-addressing">
        <h2>Public Addressing</h2>
        <p>
          In addition to [[!ActivityStreams]] collections and objects,
          Activities may additionally be addressed to the special "public"
          collection, with the identifier
          <code>https://www.w3.org/ns/activitystreams#Public</code>.
          For example:
        </p>
        <pre class="example">
          {
            "@context": "https://www.w3.org/ns/activitystreams",
            "id": "https://www.w3.org/ns/activitystreams#Public",
            "type": "Collection"
          }
        </pre>
        <p>
          Activities addressed to this special URI shall be accessible to all
          users, without authentication.
          Implementations MUST NOT deliver to the "public" special collection;
          it is not capable of receiving actual activities.
          However, actor has a
          <a href="#publicInbox"><code>publicInbox</code></a>
          endpoint is available for efficient shared delivery of public posts;
          see <a href="#public-inbox-delivery"></a>.
        </p>
      </section>

      <section id="likes-collection">
        <h2>Likes Collection</h2>
        <p>
          Every object MAY have a <code>likes</code> collection.
          This is a list of all <code>Like</code> activities with this object
          as the <code>object</code> property, added as a
          <a href="#like-activity-inbox">side effect</a>.
          The <code>likes</code> collection MUST be either an
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>
          or a
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
            <code>Collection</code></a>
          and MAY be filtered on privileges of an authenticated user
          or as appropriate when no authentication is given.
        </p>

        <div class="note">
          <p>
            Care should be taken to not confuse the the
            <a href="#likes-collection"><code>likes</code></a>
            collection with the similarly named but different
            <a href="#liked-collection"><code>liked</code></a> collection.
            In sum:
          </p>

          <ul>
            <li>
              <b>liked:</b>
              Specifically a property of actors.
              This is a collection of <code>Like</code> activities performed
              <i>by the actor</i>,
              added to the collection as a
              <a href="#like-activity-outbox">
                side effect of delivery to the outbox</a>.
            </li>

            <li>
              <b>likes:</b>
              May be a property of any object.
              This is a collection of <code>Like</code> activities referencing
              this object,
              added to the collection as a
              <a href="#like-activity-inbox">
                side effect of delivery to the inbox</a>.
            </li>
          </ul>
        </div>
      </section>

      <section id="shares-collection">
        <h2>Shares Collection</h2>
        <p>
          Every object MAY have a <code>shares</code> collection.
          This is a list of all <code>Announce</code> activities with this object
          as the <code>object</code> property, added as a
          <a href="#announce-activity-inbox">side effect</a>.
          The <code>shares</code> collection MUST be either an
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>
          or a
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
            <code>Collection</code></a>
          and MAY be filtered on privileges of an authenticated user
          or as appropriate when no authentication is given.
        </p>
      </section>
    </section>

    <section id="uploading-media">
      <h2>Uploading Media</h2>
      <p>
        ActivityPub supports uploading document types to be referenced in
        activites, such as images, video or other binary data, and servers
        MAY implement this feature.
        To accomplish this, a client MUST submit a
        <code>multipart/form-data</code> message to the user's
        <a href="#uploadMedia"><code>uploadMedia</code></a> endpoint on their
        ActivityStreams profile object.
        A client should expect that it must be properly authenticated in order
        to be able to upload media.
      </p>

      <p>
        The submitted form data should contain two parts / fields:
      </p>

      <dl>
        <dt id="uploading-media-file">file</dt>
        <dd>
          The media file file being uploaded.
        </dd>
        <dt id="uploading-media-object">object</dt>
        <dd>
          A shell of an ActivityStreams object, which will be finalized by the
          server.
        </dd>
      </dl>

      <p>
        Assuming that the server accepts the request and that the user was
        appropriately authorized to upload media, servers MUST respond with a
        <code>201 Created</code> if the object is immediately available or a
        <code>202 Accepted</code> if the server is still processing the
        submitted media.
        The response MUST contain a <code>Location</code> header pointing
        to the new or to-be-created object's <code>id</code>.
      </p>

      <p>
        The server, having done any appropriate processing on the received
        <code>file</code> and putting it in place, transforms the
        <code>object</code> that will be retrievable by the <code>id</code>.
        In particular, servers MUST append an <code>id</code> property to the
        object, and SHOULD include the uploaded and/or processed file paths in
        the object's <code>url</code> property.
        The server MAY wrap the shell object submitted by the user in a
        <code>Create</code> via <a href="#object-without-create"></a> if
        appropriate and present this as the object pointed to by the
        forementioned <code>Location</code> header in the post-media-upload
        response.
      </p>
    </section>

    <section id="client-to-server-interactions">
      <h2>Client to Server Interactions</h2>
      <p>
        Activities as defined by [[!ActivityStreams]] are the core mechanism
        for creating, modifying and sharing content within the social graph.
      </p>

      <p>
        Client to server interaction takes place through clients posting
        Activities to a user's <a href="#outbox">outbox</a>.
        To do this, clients MUST discover the URL of the user's outbox from
	their <a href="#actor-objects">profile</a> and then MUST make an HTTP
        <code>POST</code> request to to this URL with the Content-Type of
        <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>.
        The request MUST be authenticated with the credentials of the user to
        whom the outbox belongs.
        The body of the <code>POST</code> request MUST contain a single
        Activity (which MAY contain embedded objects), or a single non-Activity
        object which
        <a href="#object-without-create">will be wrapped in a Create activity
          by the server</a>.
      </p>
      <pre class="example" title="Submitting an Activity to the Outbox">
POST /outbox/ HTTP/1.1
Host: dustycloud.org
Authorization: Bearer XXXXXXXXXXX
Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"

{
  "@context": ["https://www.w3.org/ns/activitystreams",
               {"@language": "en"}],
  "type": "Like",
  "actor": "https://dustycloud.org/chris/"
  "name": "Chris liked 'Minimal ActivityPub update client'",
  "object": "https://rhiaro.co.uk/2016/05/minimal-activitypub",
  "to": ["https://rhiaro.co.uk/#amy",
         "https://dustycloud.org/followers",
         "https://rhiaro.co.uk/followers/"],
  "cc": "https://e14n.com/evan"
}
      </pre>

      <p>
        <strong>Clients</strong> are responsible for addressing new Activites
        appropriately.
        To some extent, this is dependent upon the particular client
        implementation, but clients must be aware that the server will only
        forward new Activities to addressees in the <code>to</code>,
        <code>bto</code>, <code>cc</code>, <code>bcc</code>, and
        <code>audience</code> fields.
      </p>
      <p>
        The <a href="#followers">Followers Collection</a> and/or the
        <a href="#public-addressing">Public Collection</a> are good
        choices for the default addressing of new Activities.
      </p>
      <p>
        Clients SHOULD look at any objects attached to the new Activity via the
        <code>object</code>, <code>target</code>, <code>inReplyTo</code> and/or
        <code>tag</code> fields, retrieve <em>their</em> <code>actor</code> or
        <code>attributedTo</code> properties, and MAY also retrieve their addressing
        properties, and add these to the <code>to</code> or <code>cc</code>
        fields of the new Activity being created.
        Clients MAY recurse through attached objects, but if doing so, SHOULD
        set a limit for this recursion.
      </p>
      <p>
        Clients MAY give the user the chance to amend this addressing in the
        UI.
      </p>
      <p>
        For example, when Chris likes the following article by Amy:
      </p>

      <pre class="example" title="An Article">
{
  "@context": ["https://www.w3.org/ns/activitystreams",
               {"@language": "en-GB"}],
  "id": "https://rhiaro.co.uk/2016/05/minimal-activitypub",
  "type": "Article",
  "name": "Minimal ActivityPub update client",
  "content": "Today I finished morph, a client for posting ActivityStreams2...",
  "attributedTo": "<strong>https://rhiaro.co.uk/#amy</strong>",
  "to": "<strong>https://rhiaro.co.uk/followers/</strong>",
  "cc": "<strong>https://e14n.com/evan</strong>"
}
      </pre>

      <p>the like is generated by the client as:</p>

      <pre class="example" title="A Like of the Article">
{
  "@context": ["https://www.w3.org/ns/activitystreams",
               {"@language": "en"}],
  "type": "Like",
  "actor": "https://dustycloud.org/chris/"
  "summary": "Chris liked 'Minimal ActivityPub update client'",
  "object": "https://rhiaro.co.uk/2016/05/minimal-activitypub",
  "to": ["<strong>https://rhiaro.co.uk/#amy</strong>",
         "https://dustycloud.org/followers",
         "<strong>https://rhiaro.co.uk/followers/</strong>"],
  "cc": "<strong>https://e14n.com/evan</strong>"
}
      </pre>

      <p>The receiving outbox can then perform <a href="#delivery">delivery</a>
      to not only the followers of Chris (the liker), but also to Amy, and Amy's
      followers and Evan, both of whom received the original article.</p>

      <p>
        If an Activity is submitted with a value in the <code>id</code>
        property, servers MUST ignore this and generate a new <code>id</code>
        for the Activity.
        Servers MUST return a <code>201 Created</code> HTTP code, and unless
        the activity is transient, MUST include the new <code>id</code> in the
        <code>Location</code> header.
      </p>
      <pre class="example" title="Outbox response to submitted Activity">
HTTP/1.1 201 Created
Location: https://dustycloud.org/likes/345
      </pre>

      <p>
        The server MUST remove the <code>bto</code> and/or <code>bcc</code>
        properties, if they exist, from the ActivityStreams object before
        storage and delivery, but MUST utilize the addressing originally stored
        on the <code>bto</code> / <code>bcc</code> properties for determining
        recipients in <a href="#delivery">delivery</a>.
      </p>

      <p>
        The server MUST then add this new Activity to the
        <a href="#outbox">outbox</a> collection.
        Depending on the type of Activity, servers may then be required to
        carry out further side effects.
        These are described per individual Activity below.
      </p>

      <p>
        Clients submitting the following activities to an <code>outbox</code>
        MUST provide the <code>object</code> property in the activity:
        <code>Create</code>, <code>Update</code>, <code>Delete</code>,
        <code>Follow</code>, <code>Add</code>, <code>Remove</code>,
        <code>Like</code>, <code>Block</code>, <code>Undo</code>.
        Additionally, clients submitting the following activities to an outbox
        MUST also provide the <code>target</code> property:
        <code>Add</code>, <code>Remove</code>.
      </p>

      <p>
        HTTP caching mechanisms [[!RFC7234]] SHOULD be respected when
        appropriate, both in clients receiving responses from servers as well
        as servers sending responses to clients.
      </p>

      <section id="create-activity-outbox">
        <h3>Create Activity</h3>
        <p>
          The <code>Create</code> activity is used when posting a new object.
          This has the side effect that the object embedded within the Activity
          (in the <code>object</code> property) is created.
        </p>
        <p>
          When a <code>Create</code> activity is posted, the <code>actor</code>
          of the activity SHOULD be copied onto the <code>object</code>'s
          <code>attributedTo</code> field.
        </p>
        <p>
          A mismatch between addressing of the Create activity and its
          <code>object</code> is likely to lead to confusion.
          As such, a server SHOULD copy any recipients of the Create activity
          to its <code>object</code> upon initial distribution, and likewise
          with copying recipients from the <code>object</code> to the wrapping
          Create activity.
          Note that it is acceptable for the <code>object</code>'s addressing
          to be changed later without changing the <code>Create</code>'s
          addressing (for example via an <code>Update</code> activity).
        </p>

        <section id="object-without-create">
        <h4>Object creation without a Create Activity</h4>
        <p>
          For client to server posting, it is possible to submit an object for
          creation without a surrounding activity.
          The server MUST accept a valid [[!ActivityStreams]] object that
          isn't a subtype of <code>Activity</code> in the POST request to the
          outbox.
          The server then MUST attach this object as the <code>object</code>
          of a <a href="#create-activity-outbox">Create Activity</a>.
          For non-transient objects, the server MUST attach an
          <code>id</code> to both the wrapping <code>Create</code> and its
          wrapped <code>Object</code>.
        </p>

        <p class="note">
          The <code>Location</code> value returned by the server should be the URL of
          the new Create activity (rather than the object).
        </p>

        <p>
          Any <code>to</code>, <code>bto</code>, <code>cc</code>, <code>bcc</code>,
          and <code>audience</code> properties specified on the object MUST be
          copied over to the new Create activity by the server.
        </p>

        <pre class="example" title="Object with audience targeting">
        {
          "@context": "https://www.w3.org/ns/activitystreams",
          "type": "Note",
          "content": "This is a note",
          "published": "2015-02-10T15:04:55Z",
          "to": ["https://example.org/~john/"],
          "cc": ["https://example.com/~erik/followers",
                 "https://www.w3.org/ns/activitystreams#Public"]
        }
        </pre>

        The above example could be converted to this:
        <pre class="example" title="Create Activity wrapper generated by the server">
        {
          "@context": "https://www.w3.org/ns/activitystreams",
          "type": "Create",
          "id": "https://example.net/~mallory/87374"
          "actor": "https://example.net/~mallory",
          "object": {
            "id": "https://example.com/~mallory/note/72",
            "type": "Note",
            "attributedTo": "https://example.net/~mallory",
            "content": "This is a note",
            "published": "2015-02-10T15:04:55Z",
            "to": ["https://example.org/~john/"],
            "cc": ["https://example.com/~erik/followers",
                   "https://www.w3.org/ns/activitystreams#Public"]
          },
          "published": "2015-02-10T15:04:55Z",
          "to": ["https://example.org/~john/"],
          "cc": ["https://example.com/~erik/followers",
                 "https://www.w3.org/ns/activitystreams#Public"]
        }
        </pre>
        </section>
      </section>
      <section id="update-activity-outbox">
        <h3>Update Activity</h3>
        <p>
          The <code>Update</code> activity is used when updating an already
          existing object.
          The side effect of this is that the <code>object</code> MUST be
          modified to reflect the new structure as defined in the update
          activity, assuming the actor has permission to update this
          object.
        </p>

        <section id="partial-updates">
          <h4>Partial Updates</h4>
          <p>
            For client to server interactions, updates are partial;
            rather than updating the document all at once, any key value
            pair supplied is used to replace the existing value with
            the new value.
            This only applies to the top-level fields of the updated
            object.
            A special exception is for when the value is the json
            <code>null</code> type; this means that this field should be
            removed from the server's representation of the object.
          </p>
          <p>
            Note that this behavior is for client to server interaction where
            the client is posting to the server only.
            Server to server interaction and updates from the server to the client
            should contain the entire new representation of the object, after
            the partial update application has been applied.
            See the description of the
            <a href="#update-activity-inbox">Update activity for server to server
              interactions</a>
            for more details.
          </p>
        </section>
      </section>
      <section id="delete-activity-outbox">
        <h3>Delete Activity</h3>
        <p>
          The <code>Delete</code> activity is used to delete an already
          existing object.
          The side effect of this is that the server MAY replace the
          <code>object</code> with a <code>Tombstone</code> of the object
          that will be displayed in activities which reference the deleted
          object.
          If the deleted object is requested the server SHOULD respond with
          either the HTTP 410 Gone status code if a <code>Tombstone</code>
          object is presented as the response body, otherwise respond with a
          HTTP 404 Not Found.
        </p>

        <p>
          A deleted object:
          <pre class="example">
            {
              "@context": "https://www.w3.org/ns/activitystreams",
              "id": "https://example.com/~alice/note/72",
              "type": "Tombstone",
              "published": "2015-02-10T15:04:55Z",
              "updated": "2015-02-10T15:04:55Z",
              "deleted": "2015-02-10T15:04:55Z",
            }
          </pre>
        </p>
      </section>
      <section id="follow-activity-outbox">
        <h3>Follow Activity</h3>
        <p>
          The <code>Follow</code> activity is used to subscribe to the
          activities of another user.
        </p>
        <p>
          The side effect of receiving this in an <strong>outbox</strong>
          is that the server SHOULD add the <code>object</code> to the
          <code>actor</code>'s <a href="#following"><code>following</code> Collection</a>.
        </p>
      </section>
      <section id="add-activity-outbox">
        <h3>Add Activity</h3>
        <p>
          Upon receipt of an <code>Add</code> activity into the
          <strong>outbox</strong>, the server SHOULD
          add the <code>object</code> to the collection specified in the
          <code>target</code> property, unless:
        </p>
        <ul>
          <li>
            the <code>target</code> is not owned by the receiving
            server, and thus they are not authorized to update it.
          </li>
          <li>
            the <code>object</code> is not allowed to be added to the
            <code>target</code> collection for some other reason, at the
            receiving server's discretion.
          </li>
        </ul>
      </section>
      <section id="remove-activity-outbox">
        <h3>Remove Activity</h3>
        <p>
          Upon receipt of a <code>Remove</code> activity into the
          <strong>outbox</strong>, the server SHOULD
          remove the <code>object</code> from the collection specified in the
          <code>target</code> property, unless:
        <ul>
          <li>
            the <code>target</code> is not owned by the receiving server, and
            thus they are not authorized to update it.
          </li>
          <li>
            the <code>object</code> is not allowed to be removed from the
            <code>target</code> collection for some other reason, at the
            receiving server's discretion.
          </li>
        </ul>
      </section>
      <section id="like-activity-outbox">
        <h3>Like Activity</h3>
        <p>
          The <code>Like</code> activity indicates the <code>actor</code> likes
          the <code>object</code>.
        </p>
        <p>
          The side effect of receiving this in an <strong>outbox</strong>
          is that the server SHOULD add the <code>object</code> to the
          <code>actor</code>'s <a href="#liked"><code>liked</code> Collection</a>.
        </p>
      </section>
      <section id="block-activity-outbox">
        <h3>Block Activity</h3>
        <p>
          The <code>Block</code> activity is used to indicate that the posting
          actor does not want another actor (defined in the <code>object</code>
          property) to be able to interact with objects posted by the actor
          posting the <code>Block</code> activity.
          The server SHOULD prevent the blocked user from interacting with any object
          posted by the actor.
        </p>
        <p>
          Servers SHOULD NOT deliver Block Activities to their <code>object</code>.
        </p>
      </section>
      <section id="undo-activity-outbox">
        <h3>Undo Activity</h3>
        <p>
          The <code>Undo</code> activity is used to undo a previous activity.
          See the Activity Vocabulary documentation on
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#inverse">
            Inverse Activities and "Undo"</a>.
          For example, <code>Undo</code> may be used to undo a previous
          <code>Like</code> or <code>Follow</code>.
          The undo activity and the activity being undone MUST both have the
          same author.
          Side effects should be undone, to the extent possible.
          For example, if undoing a <code>Like</code>, any counter that had
          been incremented previously should be decremented appropriately.
        </p>

        <p>
          There are some exceptions where there is an existing and explicit
          "inverse activity" which should be used instead.
          <code>Create</code> based activities should instead use
          <code>Delete</code>, and <code>Add</code> activities should use
          <code>Remove</code>.
        </p>
      </section>

      <section id="client-to-server-outbox-delivery">
        <h3>Delivery</h3>
        <p>
          Federated servers MUST perform delivery on all Activities posted to the
          <strong>outbox</strong> according to <a href="#outbox-delivery">
          outbox delivery</a>.
        </p>
      </section>
    </section>

    <section id="server-to-server-interactions">
      <h2>Server to Server Interactions</h2>
      <p>
        Servers communicate with other servers and propagate information across
        the social graph by posting activities to actors'
        <a href="#inbox">inbox</a> endpoints.
        An Activity sent over the network SHOULD have an <code>id</code>,
        unless it is intended to be transient (in which case it MAY omit the
        <code>id</code>).
      </p>
      <p>
        In order to propagate updates throughout the social graph, Activities
        are sent to the appropriate recipients.
        First, these recipients are determined through following the
        appropriate links between objects until you reach an actor, and then
        the Activity is inserted into the actor's <em>inbox</em>
        (<a href="#delivery">delivery</a>).
        This allows recipient servers to:
      </p>
      <ul>
        <li>
          conduct any side effects related to the Activity (for example,
          notification that a user has liked an object is used to update the
          object's like count);
        </li>
        <li>
          deliver the Activity to recipients of the original object, to ensure
          updates are propagated to the whole social graph (see <a href=#inbox-delivery>
          inbox delivery</a>).
        </li>
      </ul>
      <p>Delivery is usually triggered by, for example:</p>
      <ul>
        <li>
          an Activity being created in a user's <a href="#outbox">outbox</a>
          with their <a href="#followers">Followers Collection</a> as the
          recipient.
        </li>
        <li>
          an Activity being created in a user's <a href="#outbox">outbox</a>
          with directly addressed recipients.
        </li>
        <li>
          an Activity being created in a user's <a href="#outbox">outbox</a>
          with user-curated collections as recipients.
        </li>
        <li>
          an Activity being created in a user's <a href="#outbox">outbox</a> or
          <a href="#inbox">inbox</a> which references another object.
        </li>
      </ul>

      <p>
        Servers performing delivery to the <code>inbox</code> or
        <code>publicInbox</code> properties of actors on other servers MUST
        provide the <code>object</code> property in the activity:
        <code>Create</code>, <code>Update</code>, <code>Delete</code>,
        <code>Follow</code>, <code>Add</code>, <code>Remove</code>,
        <code>Like</code>, <code>Block</code>, <code>Undo</code>.
        Additionally, servers performing server to server delivery of the
        following activities MUST also provide the <code>target</code>
        property: <code>Add</code>, <code>Remove</code>.
      </p>

      <p>
        HTTP caching mechanisms [[!RFC7234]] SHOULD be respected when
        appropriate, both when receiving responses from other servers as well
        as sending responses to other servers.
      </p>

      <section id="delivery">
        <h2>Delivery</h2>

        <p><i>
          The following is required by federated servers communicating with
          other federated servers only.
        </i></p>

        <p>
          An activity is delivered to its targets (which are
          <a href="#actors">actors</a>) by first looking up the targets'
          inboxes and then posting the activity to those inboxes.
          Targets for delivery are determined by checking the
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#audienceTargeting">
            ActivityStreams audience targeting</a>;
          namely, the <code>to</code>, <code>bto</code>, <code>cc</code>,
          <code>bcc</code>, and <code>audience</code> fields of the activity.
        </p>

        <p>
          The <a href="#inbox">inbox</a> is determined by first
          <a href="#retrieving-objects">
            retrieving the target actor's JSON-LD representation</a>
          and then looking up the <code>inbox</code> property.
          If a recipient is a <code>Collection</code> or <code>OrderedCollection</code>,
          then the server MUST dereference the collection (with the user's
          credentials) and discover inboxes for each item in the collection.
          Servers MUST limit the number of layers of indirections through
          collections which will be performed, which MAY be one.
        </p>

        <p>
          Servers MUST de-duplicate the final recipient list. Servers MUST also
          exclude actors from the list which are the same as the <code>actor</code>
          of the Activity being notified about. That is, users shouldn't have their
          own activities delivered to themselves.
        </p>

        <p class="note" title="Silent and private activities">
          What to do when there are no recipients specified is not defined,
          however it's recommended that if no recipients are specified the
          object remains completely private and access controls restrict the
          access to object.
          If the object is just sent to the "public" collection the object is
          not delivered to any users but is publicly viewable in the actor's
          outbox.
        </p>

        <p>
          An HTTP POST request (with authorization of the submitting user) is
          then made to to the <a href="#inbox">inbox</a>, with the Activity as
          the body of the request.
          This Activity is added by the receiver as an <code>item</code> in the
          <a href="#inbox">inbox</a> OrderedCollection.
          Attempts to deliver to an inbox on a non-federated server SHOULD
          result in a 405 Method Not Allowed response.
        </p>

        <p>
          For federated servers performing delivery to a third party server,
          delivery SHOULD be performed asynchronously, and SHOULD additionally
          retry delivery to recipients if it fails due to network error.
          Servers SHOULD also take care not to overload servers with
          submissions, for example by using an exponential backoff strategy.
        </p>

        <p>
          <strong>Note:</strong> Activities being distributed between users on
          the same origin may use any internal mechanism, and are not required
          to use HTTP.
        </p>

        <p class="note" title="Relationship to Linked Data Notifications">
          While it is not required reading to understand this specification,
          it is worth noting that ActivityPub's targeting and delivery
          mechanism overlaps with the
          <a href="https://www.w3.org/TR/ldn/">Linked Data Notifications</a>
          specification, and the two specifications may interoperably
          combined.
          In particular, the <code>inbox</code> property is the same between
          ActivityPub and Linked Data Notifications, and the targeting
          and delivery systems described in this document are supported
          by Linked Data Notifications.
          In addition to JSON-LD compacted ActivityStreams documents, Linked
          Data Notifications also supports a number of RDF serializations
          which are not required for ActivityPub implementations.
          However, ActivityPub implementations which wish to be more broadly
          compatible with Linked Data Notifications implementations may wish to
          support other RDF representations.
        </p>

        <section id="outbox-delivery">
          <h3>Outbox Delivery</h3>
          <p>
            When objects are received in the <a href="#outbox">outbox</a>, the
            server MUST target and deliver to:
          </p>
          <ul>
            <li>
              The <code>to</code>, <code>bto</code>, <code>cc</code>,
              <code>bcc</code> or <code>audience</code> fields if their values
              are individuals or Collections owned by the actor.
            </li>
          </ul>
          <p>
            These fields will have been <a href="#client-to-server-interactions">
            populated appropriately by the client</a> which posted the Activity
            to the outbox.
          </p>
        </section>

        <section id="inbox-delivery">
          <h3>Forwarding from Inbox</h3>
          <p>
            When Activities are received in the <a href="#inbox">inbox</a>, the
            server needs to forward these to recipients that the origin was unable
            to deliver them to. To do this, the server MUST target and
            <a href="#delivery">deliver</a>
            to the values of <code>to</code>, <code>bto</code>, <code>cc</code>,
            <code>bcc</code>, and/or <code>audience</code>
            if and only if all of the following are true:
          </p>
          <ul>
            <li>This is the first time the server has seen this Activity.</li>
            <li>
              The values of <code>to</code>, <code>bto</code>, <code>cc</code>,
              <code>bcc</code>, and/or <code>audience</code> contain a
              Collection owned by the server.
            </li>
            <li>
              The values of <code>inReplyTo</code>, <code>object</code>,
              <code>target</code> and/or <code>tag</code> are objects owned by
              the server.
              The server SHOULD recurse through these values to look for linked objects
              owned by the server, and SHOULD set a maximum limit for recursion (ie. the
              point at which the thread is so deep the recipients followers may not mind
              if they are no longer getting updates that don't directly involve the
              recipient).
              The server MUST only target the values of <code>to</code>, <code>bto</code>,
              <code>cc</code>, <code>bcc</code>, and/or <code>audience</code>
              on the original object being forwarded, and not pick up any new
              addressees whilst recursing through the linked objects
              (in case these addressees were purposefully amended by or via the client).
            </li>
          </ul>
          <p>
            The server MAY filter its delivery targets according to
            implementation-specific rules (for example, spam filtering).
          </p>
        </section>

        <section id="public-inbox-delivery">
          <h2>Public Inbox Delivery</h2>
          <p>
            For servers hosting many actors, delivery to all participants can
            result in an overwhelming number of messages sent.
            Some servers would also like to display a list of all messages
            posted publicly to the "known network".
            Thus ActivityPub provides an optional mechanism for serving these
            two use cases.
          </p>
          <p>
            When an origin server is sending an activity to a remote server
            which is addressed with the special
            <a href="#public-addressing">Public</a>
            recipient, the origin server MAY reduce the number of actors
            delivered to by identifying all actors which would be recipients
            who share a
            <a href="#publicInbox">publicInbox</a>
            who would otherwise be individual recipients and instead deliver
            to only <code>publicInbox</code> objects.
            (An origin server MAY alternately decide to publish all posts
            to all <code>publicInbox</code> endpoints known.)
            The server with the receiving <code>publicInbox</code> should
            use its own <a href="#following">following lists</a> to determine
            which actors should have the post delivered to their inbox.
            Thus in this scenario, the remote/receiving server participates
            in determining targeting and performing delivery to specific
            inboxes.
          </p>
          <p>
            Origin servers sending publicly addressed activities to
            <code>publicInbox</code> endpoints MUST still deliver to actors
            and collections otherwise addressed (through <code>to</code>,
            <code>bto</code>, <code>cc</code>, <code>bcc</code>, and
            <code>audience</code>) which do not have a <code>publicInbox</code>
            and would not otherwise receive the activity through the
            <code>publicInbox</code> mechanism.
          </p>
        </section>
      </section>

      <section id="create-activity-inbox">
        <h3>Create Activity</h3>
        <p>
          Receiving a <code>Create</code> activity in an <code>inbox</code> has
          surprisingly few side effects; the activity should appear in the
          actor's <code>inbox</code> and it is likely that the server will want
          to locally store a representation of this activity and its accompanying
          object.
          However, this mostly happens in general with processing activities
          delivered to an <code>inbox</code> anyway.
        </p>
      </section>

      <section id="update-activity-inbox">
        <h3>Update Activity</h3>
        <p>
          For server to server interactions, an <code>Update</code> activity
          means that the receiving server SHOULD update its copy of the
          <code>object</code> of the same <code>id</code> to the copy
          supplied in the <code>Update</code> activity.
          Unlike the
          <a href="#update-activity-outbox">
            client to server handling of the Update activity</a>,
          this is not a partial update but a complete replacement of the object.
        </p>
        <p>
          The receiving server MUST take care to be sure that the
          <code>Update</code> is authorized to modify its <code>object</code>.
          At minimum, this may be done by ensuring that the <code>Update</code>
          and its <code>object</code> are of same origin.
        </p>
      </section>

      <section id="delete-activity-inbox">
        <h3>Delete Activity</h3>
        <p>
          The side effect of receiving this is that (assuming the
          <code>object</code> is owned by the sending actor / server) the
          server receiving the delete activity SHOULD remove its representation
          of the <code>object</code> with the same <code>id</code>, and MAY
          replace that representation with a <code>Tombstone</code> object.
        </p>
        <p>
          (Note that after an activity has been transmitted from an origin
          server to a remote server, there is nothing in the ActivityPub
          protocol that can <em>enforce</em> remote deletion of an object's
          representation.)
        </p>
      </section>

      <section id="follow-activity-inbox">
        <h3>Follow Activity</h3>
        <p>
          The side effect of receving this in an <strong>inbox</strong> is
          that the server SHOULD add the <code>actor</code> to the <code>object</code>
          user's <a href="#followers">Followers Collection</a>.
        </p>
      </section>
      <section id="add-activity-inbox">
        <h3>Add Activity</h3>
        <p>
          Upon receipt of an <code>Add</code> activity into the
          <strong>inbox</strong>, the server SHOULD
          add the <code>object</code> to the collection specified in the
          <code>target</code> property, unless:
        </p>
        <ul>
          <li>
            the <code>target</code> is not owned by the receiving server, and
            thus they can't update it.
          </li>
          <li>
            the <code>object</code> is not allowed to be added to the
            <code>target</code> collection for some other reason, at the
            receiver's discretion.
          </li>
        </ul>
      </section>
      <section id="remove-activity-inbox">
        <h3>Remove Activity</h3>
        <p>
          Upon receipt of a <code>Remove</code> activity into the
          <strong>inbox</strong>, the server SHOULD
          remove the <code>object</code> from the collection specified in the
          <code>target</code> property, unless:
        <ul>
          <li>
            the <code>target</code> is not owned by the receiving server, and
            thus they can't update it.
          </li>
          <li>
            the <code>object</code> is not allowed to be removed to the
            <code>target</code> collection for some other reason, at the
            receiver's discretion.
          </li>
        </ul>
      </section>
      <section id="like-activity-inbox">
        <h3>Like Activity</h3>
        <p>
          The side effect of receving this in an <strong>inbox</strong> is
          that the server SHOULD increment the object's count of likes by
          adding the received activity to the
          <a href="#likes-collection"><code>likes</code></a> collection
          if this collection is present.
        </p>
      </section>
      <section id="announce-activity-inbox">
        <h3>Announce Activity (sharing)</h3>
        <p>
          Upon receipt of an <code>Announce</code> activity in an
          <strong>inbox</strong>, a server SHOULD increment the object's count
          of likes by adding the received activity to the
          <a href="#shares-collection"><code>shares</code></a> collection
          if this collection is present.
        </p>
        <div class="note">
          The <code>Announce</code> activity is effectively what is known as
          "sharing", "reposting", or "boosting" in other social networks.
        </div>
      </section>
      <section id="undo-activity-inbox">
        <h3>Undo Activity</h3>
        <p>
          The <code>Undo</code> activity is used to undo the side effects
          of previous activities.
          See the ActivityStreams documentation on
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#inverse">
            Inverse Activities and "Undo"</a>.
          The scope and restrictions of the <code>Undo</code> activity
          are the same as for
          <a href="#undo-activity-outbox">
            the Undo activity in the context of client to server
            interactions</a>,
          but applied to a federated context.
        </p>
      </section>
    </section>

    <section id="authorization" class="informative">
      <h2>Authentication and Authorization</h2>
      <p>
        ActivityPub uses authentication for two purposes; first, to
        authenticate clients to servers, and secondly in federated
        implementations to authenticate servers to each other.
      </p>

      <p>
        Unfortunately at the time of standardization, there are no strongly
        agreed upon mechanisms for authentication.
        Some possible directions for authentication are laid out as follows.
      </p>

      <section id="authorization-oauth">
        <h2>OAuth 2.0 and JSON Web Signatures</h2>
        <p>
          ActivityPub implementations may use
          <a href="https://oauth.net/2/">OAuth 2.0</a>
          with
          <a href="https://tools.ietf.org/html/rfc7515">JSON Web Signatures</a> [[RFC7515]]
          for authentication and authorization.
          This has the advantage of wide deployment of OAuth 2.0 technologies.
          However, OAuth 2.0 technologies are frequently incompatible, and
          the agreed upon mechanisms for deploying via OAuth 2.0 are still in
          flux, so it is not feasible to recommend a general pattern for
          OAuth 2.0 based deployments at this time.
        </p>

        <section id="client-to-origin-oauth">
          <h2>Client to Origin Server Authentication</h2>
          <p>
            For client to server interactions where the client is interacting
            directly to the actor's server, clients may use OAuth 2.0 bearer
            tokens to authenticate.
          </p>
          <p>
            Bearer tokens may be acquired out of band. They may also be acquired
            using OAuth 2.0 authorization. To discover the correct endpoint for
            authorization, clients should use [[OAuth-Server-Metadata]] on the
            host part from the actor's ID URI.
          </p>
          <p>
            Client IDs may be acquired out of band for some servers. They may
            also be acquired using [[RFC7591]].
          </p>
        </section>

        <section id="client-to-foreign-oauth">
          <h2>Client to Foreign Server Authentication</h2>
          <p>
            For client to server interactions where the client is interacting
            with servers beyond the user's origin server, clients and servers may
            support use of OAuth 2.0 with JSON Web Signatures.
          </p>
        </section>

        <section id="server-on-behalf-of-user-oauth">
          <h2>Servers Acting on Behalf of Users</h2>
          <p>
            Servers performing operations on behalf of a user (e.g. delivery
            to a recipient) may use OAuth 2.0 with JSON Web Signatures to
            authenticate with a 3rd party server.
          </p>
        </section>
      </section>

      <section id="authorization-lds">
        <h2>Linked Data Signatures and HTTP Signatures</h2>

        <p>
          ActivityPub implementations may use
          <a href="https://web-payments.org/specs/source/ld-signatures/">
            Linked Data Signatures</a>
          and
          <a href="https://tools.ietf.org/html/draft-cavage-http-signatures-05">
            signed HTTP messages</a>
          for authentication and authorization.
          (Linked Data Signatures are best used when authentication is meant to
          be "long lived" and attached to an object, such as verifying that an
          object truly was posted by this actor, and signed HTTP messages
          should be used when authentication or authorization is ephemeral.)
          This has the advantage of clean integration with existing JSON-LD
          based technologies already used by ActivityPub.
          However, at the time of specification, Linked Data Signatures and
          HTTP signatures are very young, particularly in adoption.
        </p>

        <p>
          When Linked Data Signatures is used in combination with ActivityPub,
          the server should assign an <a href="#actors">actor</a> a public and
          private key pair, and link the public key to the <a href="#actor-objects">actor's profile
          object</a>, which may later be used with the
          <a href="https://w3c-dvcg.github.io/ld-signatures/#signature-verification-algorithm">
            Linked Data Signatures verification algorithm</a>
          to validate the authenticity of messages passed along the network.
        </p>

        <section id="client-to-origin-lds">
          <h2>Client to Origin Server Authentication</h2>
          <p>
            For client to server interactions where the client is interacting
            directly with the actor's server, a client may use HTTP signatures by
            <a href="#provideClientKey">registering their client's public key</a>
            with the actor on the server and subsequently using this key to sign
            any HTTP requests made.
          </p>
        </section>

        <section id="client-to-foreign-lds">
          <h2>Client to Foreign Server Authentication</h2>
          <p>
            For client to server interactions where the client is interacting
            with servers beyond the user's origin server, clients may use a
            combination of HTTP signatures and Linked Data Signatures.
          </p>
          <p>
            In this scenario, a client would
            <a href="#signClientKey">have their client key authorized</a>
            for a limited window of time by the key listed on their actor
            profile.
            The client key would then be used to sign HTTP requests made
            to the foreign server while also providing the signature of the
            client public key, signed by and linked to the key on their
            actor profile.
          </p>
        </section>

        <section id="server-on-behalf-of-user-lds">
          <h2>Servers Acting on Behalf of Users</h2>
          <p>
            Servers performing operations on behalf of a user (e.g. delivery to
            a recipient) may use Linked Data Signatures to authenticate with a
            3rd party server.
            This may be achieved by attaching the linked data signature to the
            activity posted to the remote inbox, signed by the actor's public
            key.
          </p>
          <p>
            Servers receiving activities verified via Linked Data
            Signatures SHOULD NOT process an object with a nonce they
            have seen before, so as to prevent replay attacks.
          </p>
        </section>
      </section>
    </section>

    <section id="i18n-concerns" class="appendix informative">
      <h2>Internationalization</h2>
      <p>
        Building an international base of users is important in a federated
        network.
        <a href="https://www.w3.org/TR/activitystreams-core/#naturalLanguageValues">
          ActivityStreams provides tooling for internationalization of content</a>,
        which should be used whenever possible.
        However, it can be difficult for implementations to determine which
        <a href="https://www.w3.org/TR/activitystreams-core/#defaultlangcontext">
          <code>@language</code> property</a>
        to provide for user-submitted content.
        The
        <a href="https://www.w3.org/International/">W3C Internationalization group</a>
        provides some
        <a href="https://www.w3.org/International/wiki/LanguageDetection">
          guidance on language detection</a>.
      </p>
    </section>

    <section id="security-considerations" class="appendix informative">
      <h2>Security Considerations</h2>
      <section id="security-verification">
        <h2>Verification and authorization</h2>
        <p>
          Servers should be careful to verify that new content is really posted
          by the author that claims to be posting it, and that the author has
          permission to update the resources it claims to.
          Discussion of how to accomplish this is laid out in the
          <a href="#obj"></a> and <a href="#authorization"></a> sections.
        </p>
      </section>

      <section id="security-localhost">
        <h2>Accessing localhost URIs</h2>
        <p>
          It is often convenient while developing to test against a process
          running on localhost.
          However, permitting requests to localhost in a production client or
          server instance can be dangerous.
          Making requests to URIs on localhost which do not require
          authorization may unintentionally access or modify resources assumed
          to be protected to be usable by localhost-only.
        </p>
        <p>
          If your ActivityPub server or client does permit making requests to
          localhost URIs for development purposes, consider making it a
          configuration option which defaults to off.
        </p>
      </section>

      <section id="security-uri-schemes">
        <h2>URI Schemes</h2>
        <p>
          There are many types of URIs aside from just <code>http</code> and
          <code>https</code>.
          Some libraries which handle fetching requests at various URI schemes
          may try to be smart and reference schemes which may be undesirable,
          such as <code>file</code>.
          Client and server authors should carefully check how their libraries
          handle requests, and potentially whitelist only certain safe URI
          types, such as <code>http</code> and <code>https</code>.
        </p>
      </section>

      <section id="security-spam">
        <h2>Spam</h2>
        <p>
          Spam is a problem in any network, perhaps especially so in federated
          networks.
          While no specific mechanism for combating spam is provided in
          ActivityPub, it is recommended that servers filter incoming content
          both by local untrusted users and any remote users through some
          sort of spam filter.
        </p>
      </section>

      <section id="security-sanitizing-content">
        <h2>Sanitizing Content</h2>
        <p>
          Any activity field being rendered for browsers (or other rich
          text enabled applications) should take care to sanitize fields
          containing markup to prevent cross site scripting attacks.
        </p>
      </section>
    </section>

    <section class="appendix informative" id="acknowledgements">
      <h2>Acknowledgements</h2>
      <p>
        This specification comes from years of hard work and experience by a
        number of communities exploring the space of federation on the web.
        In particular, much of this specification is informed by
        <a href="https://www.w3.org/community/ostatus/wiki/Main_Page">OStatus</a>
        and the
        <a href="https://github.com/pump-io/pump.io/blob/master/API.md">Pump API</a>,
        as pioneered by StatusNet (now GNU Social) and Pump.io.
        Both of those initiatives were the product of many developers' hard work,
        but more than anyone, Evan Prodromou has been a constant leader in this
        space, and it is unlikely that ActivityPub would exist in something
        resembling its current state without his hard work.
      </p>

      <p>
        Owen Shepherd built the initial version of this specification, borrowed
        from the ideas in the
        <a href="https://github.com/pump-io/pump.io/blob/master/API.md">Pump API</a>
        document, mostly as a complete rewrite of text, but sharing most of
        the primary ideas while switching from ActivityStreams 1 to
        ActivityStreams 2.
        Jessica Tallon and Christopher Allan Webber took over as editors when
        the standard moved to the W3C Social Working Group and did the majority
        of transition from Owen's document to its current state as ActivityPub.
      </p>

      <p>
        ActivityPub has been shaped by the careful input of many members in the
        W3C Social Working Group.
        ActivityPub especially owes a great debt to Amy Guy, who has done more
        than anyone to map the ideas across the different Social Working Group
        documents through her work on [[Social-Web-Protocols]].
        Amy also laid out the foundations for a significant refactoring of the
        ActivityPub spec while sprinting for four days with Christopher Allan
        Webber.
        These revisions lead to cleaner separation between the client to server
        and server components, along with clarity about ActivityPub's relationship
        to [[!LDN]], among many other improvements.
        Special thanks also goes to Benjamin Goering for putting together the
        implementation report template.
      </p>
    </section>

    <section id="security-and-privacy-review"
             class="appendix informative">
      <h2>Security and Privacy Review</h2>
      <p>
        These questions provide an overview of security and privacy
        considerations for this specification as guided by
        [[security-privacy-questionnaire]].
      </p>
      <dl>
        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#pii">
          Does this specification deal with personally-identifiable
          information?
        </a></dt>
        <dd>
          ActivityPub's actors may contain information about the associated
          user.
          At minimum, the actor profile contains an identifier which also
          provides a mechanism for contacting the actor, through the exposed
          actor's inbox.
          Aside from this, ActivityPub does not mandate any personally
          identifiable information to operate, though depending on the
          implementation, any number of details may be exposed on the actor's
          profile, particularly user names and real names.
          Additionally, a notification payload could include personally
          identifiable information, depending on the implementation and use,
          but it is again not required for the core functionality to operate.
        </dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#credentials">
          Does this specification deal with high-value data?
        </a></dt>
        <dd>
          Same implications as personally-identifiable information in
          notification payload (as mentioned above).
          The application supplies no normative mechanism for authentication
          from clients to servers, but depending on what mechanism is used,
          OAuth tokens may be exposed, particularly if HTTP is used without
          TLS/SSL support.
          Similarly, no normative mechanism for authentication between servers
          is exposed, though without TLS/SSL support, OAuth tokens could be
          exposed here as well.
        </dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#persistent-origin-specific-state">
          Does this specification introduce new state for an origin that
          persists across browsing sessions?
        </a></dt>
        <dd>
          No.
          Clients may choose to cache server state information supplied
          through the application, though this is not mandated or specified.
        </dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#persistent-identifiers">
          Does this specification expose persistent, cross-origin state to the
          web?
        </a></dt>
        <dd>
          Yes.
          Clients, if appropriately authorized, may read some inbox / outbox
          information from other actors on the web.
          Additionally, servers both read and submit activities to other servers
          on the network.
        </dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#other-data">
          Does this specification expose any other data to an origin that it
          doesn’t currently have access to?
        </a></dt>
        <dd>
          No.
          (Or at least, not as far as the person filling out this section can
          tell.)
        </dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#string-to-script">
          Does this specification enable new script execution/loading
          mechanisms?
        </a></dt>
        <dd>No.</dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#location">
          Does this specification allow an origin access to a user’s location?
        </a></dt>
        <dd>No.</dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#sensors">
          Does this specification allow an origin access to sensors on a
          user’s device?
        </a></dt>
        <dd>No.</dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#local-device">
          Does this specification allow an origin access to aspects of a
          user’s local computing environment?
        </a></dt>
        <dd>No.</dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#remote-device">
          Does this specification allow an origin access to other devices?
        </a></dt>
        <dd>No.</dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#native-ui">
          Does this specification allow an origin some measure of control over
          a user agent’s native UI?
        </a></dt>
        <dd>No.</dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#temporary-id">
          Does this specification expose temporary identifiers to the web?
        </a></dt>
        <dd>
          Not directly.
          However, mechanisms to authenticate an actor or authorize behavior
          might.
        </dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#first-third-party">
          Does this specification distinguish between behavior in first-party
          and third-party contexts?
        </a></dt>
        <dd>
          No.
        </dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#incognito">
          How should this specification work in the context of a user agent’s
          "incognito" mode?
        </a></dt>
        <dd>
          Being in "incognito" mode means that authentication information a
          browser or agent might keep between sessions would not be preserved,
          thus limiting access to any content requiring explicit authorization.
        </dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#storage">
          Does this specification persist data to a user’s local device?
        </a></dt>
        <dd>
          This depends on implementation.
          Clients might choose to cache activities they have previously
          seen, but this is not a normative requirement.
          Depending on the authentication method used, authentication tokens or
          keys may be persisted.
        </dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#considerations">
          Does this specification have a "Security Considerations" and
          "Privacy Considerations" section?
        </a></dt>
        <dd>
          You're looking at it!
        </dd>

        <dt><a href="https://www.w3.org/TR/2015/NOTE-security-privacy-questionnaire-20151210/#relaxed-sop">
          Does this specification allow downgrading default security
          characteristics?
        </a></dt>
        <dd>
          No.
        </dd>
      </dl>
    </section>

    <section class="appendix informative">
      <h2>Change Log</h2>

      <section id="changes-17-nov-11-apr">
        <h3>Changes from 17 November 2016 to 11 April 2017</h3>
        <ul>
          <li>Various wording clarifications and grammatical fixes.</li>
          <li>Added some informative references.</li>
          <li>Update security and privacy questionnaire answers for incognito mode and "local device" to be
          closer to implementation.</li>
          <li>Correct typo in <code>Content-Type</code> for posting to <code>outbox</code>.</li>
          <li>
            Move duplicate ActivityStreams properties from main Actors section
            into subsection that's marked clearly as non-normative.
          </li>
        </ul>
      </section>

      <section id="changes-04-oct-17-nov">
        <h3>Changes from 04 October 2016 to 17 November 2016</h3>
        <ul>
          <li>
            Various typo / grammar fixes.
          </li>
          <li>Added <code>@language</code> to many examples.</li>
          <li>Linked to the i18n LanguageDetection wiki page.</li>
          <li>Switched to using a Japanese example for Person example.</li>
          <li>
            Note that ActivityPub shares the same URI / IRI conventions
            as in ActivityStreams.
          </li>
          <li>
            Added notes about text direction for natural language values.
          </li>
          <li>
            More clearly reference ActivityStreams targeting in the overview.
          </li>
          <li>
            Clarify that followers/following are links/uris, not embedded.
          </li>
          <li>
            Marked preferredUsername at-risk.
          </li>
          <li>
            Clarify that likes/following/followers collections MAY be filtered.
          </li>
          <li>
            Switch over to activitystreams namespace.
          </li>
          <li>
            Update the special Public collection to point to use a fragment
            identifier.
          </li>
          <li>
            Switch federation like side effect from MAY->SHOULD and widen
            effect possibilities.
          </li>
          <li>
            Make ActivityPub document readable without LDN, but clearly
            describe overlap.
          </li>
          <li>
            Beter text around displaying 404 or 403 if an object is private.
          </li>
          <li>
            Add Undo activity for federated contexts.
          </li>
          <li>
            Add public content delivery section, marked at risk.
          </li>
          <li>
            Add non-normative recommendation that implementations seeking to
            gain broader interop with LDN might want to support other RDF types.
          </li>
          <li>
            "Object without Create" section marked at-risk.
          </li>
          <li>
            Renamed "Binary Data" to "Uploading Media".
          </li>
          <li>
            Significant refactoring to media endpoint's mechanism.
            Now works on a single request.
          </li>
          <li>
            Add text about adding an id to both an object and its wrapping Create.
          </li>
          <li>
            Add Public special collection to some more examples.
          </li>
          <li>
            Note that implementations MUST NOT deliver to the Public special
            collection.
          </li>
          <li>
            Merged targeting and delivery; remove outdated "notification targeting".
          </li>
          <li>
            Note that bcc/bto must be stripped from the delivered
            ActivityStreams object.
          </li>
          <li>
            Add SHOULD on not overloading servers with submissions; recommend
            exponential backoff.
          </li>
          <li>
            Move "Partial Updates" to own section; mark at risk.
          </li>
          <li>
            Explicitly name addressing properties to copy for object creation
            w/o Create.
          </li>
          <li>
            Add <code>bto</code> and <code>audience</code> to everything that
            isn't referencing it currently and Reference the ActivityStreams
            audience targeting directly.
          </li>
          <li>
            Fixed non-normative citation of Micropub and Social Web Protocols.
          </li>
          <li>
            Went over all MAY / SHOULD / MUST and made sure correct everywhere.
          </li>
          <li>
            Note where <code>object</code> and <code>target</code> are required.
          </li>
          <li>
            Clarify transient messages: allowed, and happen by omitting id (not
            via fragment id).
          </li>
          <li>
            Clarify that the proxyUrl uses a form-urlencoded <code>id</code>
            parameter.
          </li>
          <li>
            Point to the AS2 docs on Undo.
          </li>
          <li>
            Added <code>Create</code> and <code>Delete</code> activities to
            the server to server side effects section and put all listed
            activities in the same order as in client to server.
          </li>
          <li>
            Updated <code>@context</code> on one example where <code>@language</code>
            moving around was reported to be confusing/distracting.
          </li>
        </ul>
      </section>

      <section id="changes-13-sept-04-oct">
        <h3>Changes from 13 September 2016 to 04 October 2016</h3>
        <ul>
          <li>Various typo / grammar fixes.</li>
          <li>Added acknowledgements section.</li>
          <li>Added security / privacy review section.</li>
          <li>
            Added "At Risk features" section, with the following features
            listed:
            <ul>
              <li>Binary data mechanism</li>
              <li>source field</li>
            </ul>
          </li>
          <li>Added source field section</li>
          <li>
            Note that using "https" as a default scheme is ok in clients,
            if a user neglected to provide one.
          </li>
          <li>Adjusted text around what verification methods are possible.</li>
          <li>Added <code>@language</code> to first example.</li>
          <li>
            Explain what we mean by "presented consistently in reverse
            chronological order" with regard to <code>OrderedCollection</code>.
          </li>
        </ul>
      </section>

      <section id="changes-23-aug-13-sept">
        <h3>Changes from 23 August 2016 to 13 September 2016</h3>
        <ul>
          <li>Various typo / grammar fixes.</li>
          <li>
            Clarify both transient identifiers and the requirements for "id"
          </li>
          <li>
            Reference the Social Working Group, Social Web protocols,
            and Micropub.
          </li>
          <li>
            Clarify that upon initial Create, both Create and object should
            share addressing.
          </li>
          <li>
            Clarify that what was previously called "streams" use
            OrderedCollections; remove "streams" as an independent term.
          </li>
          <li>
            Mention ActivityStreams paging.
          </li>
          <li>
            Add "endpoints" property to actor, move mediaEndpoint here and
            rename to "uploadMedia".
          </li>
          <li>
            Add "oauthClientAuthorize", "provideClientKey", and
            "signClientKey" endpoints.
          </li>
          <li>
            More clear specification of content negotiation on retrieving AS2
            objects; make
            <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>
            the default media type.
            Servers MAY do content negotiation but MUST respond with AS2 to the
            right content type.
          </li>
          <li>
            "Update" when used for client to server interactions may provide
            partial updates, but the complete activity is still sent from
            server to server and server to client.
          </li>
          <li>
            Support for Linked Data Signatures added as an auth mechanism.
          </li>
          <li>
            Add security section, with sections on:
            <ul>
              <li>Verification and authorization</li>
              <li>Accessing localhost URIs</li>
              <li>URI Schemes</li>
              <li>Spam</li>
            </ul>
          </li>
          <li>
            Add ActivityPub context to all examples.
            Explain what the ActivityPub context is and how it should be used.
          </li>
          <li>
            Added conformance section.
          </li>
        </ul>
      </section>

      <section id="changes-13-june-23-aug">
        <h3>Changes from 13 June 2016 to 23 August 2016</h3>

        <ul>
          <li>Various typo fixes.</li>
          <li>Clarification on file endpoint / binary uploads.</li>
          <li>Removed reference to HTTP PUT and DELETE verbs.</li>
          <li>Copy an activity's "actor" field to the "attributedTo" field.</li>
          <li>Restructuring and clarification around notification and delivery.</li>
          <li>Added Evan Prodromou and Owen Shepherd as authors to spec.</li>
          <li>
            Restructuring of document sections:
            <ul>
              <li>
                New, clearly delineated "Client to Server Interactions"
                and "Server to Server Interactions" sections.
              </li>
              <li>
                Server to server functionality now utilizes Linked Data
                Notifications.
              </li>
              <li>
                Moved activities section into the client to server / server to
                server sections, described as side effects.
              </li>
              <li>
                Collections moved earlier in document.
                Binary data section moved to after Collections.
              </li>
              <li>
                Notifications folded into targeting/delivery sections.
              </li>
            </ul>
          </li>
          <li>
            Removed duplicated content (endpoint discovery, inbox and outbox sections).
          </li>
          <li>
            When creating an object, return 201 created with Location header
            pointing to the Create activity.
          </li>
          <li>
            Moved some links from http to https.
          </li>
          <li>
            Clarify that objects may be submitted without a wrapping activity,
            and will be wrapped by Create on server.
          </li>
          <li>
            Clarification around removing content, Tombstones, expected http
            status on fetching removed objects.
          </li>
          <li>
            Describe delivery to collections not owned by replying user,
            forwarded by original poster.
          </li>
        </ul>
      </section>

      <section id="changes-28-jan-13-june">
        <h3>Changes from 28 January 2016 WD to 13 June 2016</h3>

        <ul>
          <li>Various typo fixes.</li>
          <li>Moved following, followers, url to "SHOULD" properties.</li>
          <li>
            Removed objectTypes text and simplified "streams" definition.
          </li>
          <li>Removed vague term "share activity".</li>
          <li>Changed MAY to MUST for inbox reading.</li>
          <li>Replaced all "@type" and "@id" with "type" and "id".</li>
          <li>Clarified and fixed up followers section.</li>
          <li>Added "Note" type to receiving activity example.</li>
          <li>Dropped implied "@context" from an example.</li>
          <li>Added audience targeting to examples.</li>
          <li>Make inReplyTo more explicit.</li>
          <li>New text allowing silent and private activities.</li>
          <li>Removed reference to access control in Delivery section.</li>
          <li>Added section clarifying the ACL.</li>
          <li>Added an optional "streams" property example.</li>
          <li>
            Moved preferredUsername, summary, icon to "MAY" provideable actor
            properties.
          </li>
          <li>
            Clarified dereferencing collection to deliver to contained users.
          </li>
          <li>Require validating objects posted to inbox.</li>
          <li>Incoming activities MUST have a valid URI as id.</li>
          <li>Clarify when identifiers are required.</li>
          <li>
            Permit submitting objects without activities for client to server
            object creation.
          </li>
        </ul>
      </section>
    </section>
  </body>
</html>
